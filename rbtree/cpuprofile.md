```
ubuntu@dongyang-K46CB:~/go/src/github.com/cdongyang/library/rbtree$ go tool pprof cpu.out
File: rbtree.test
Type: cpu
Time: Dec 23, 2017 at 9:12am (CST)
Duration: 39.01s, Total samples = 41.70s (106.88%)
Entering interactive mode (type "help" for commands, "o" for options)
(pprof) top
Showing nodes accounting for 23270ms, 55.80% of 41700ms total
Dropped 158 nodes (cum <= 208.50ms)
Showing top 10 nodes out of 81
      flat  flat%   sum%        cum   cum%
    8570ms 20.55% 20.55%     9970ms 23.91%  runtime.ifaceeq /usr/local/go/src/runtime/alg.go
    5210ms 12.49% 33.05%    24930ms 59.78%  github.com/cdongyang/library/rbtree.(*RBTree).insert /home/ubuntu/go/src/github.com/cdongyang/library/rbtree/RBTree.go
    1450ms  3.48% 36.52%     6710ms 16.09%  github.com/cdongyang/library/rbtree.(*RBTree).insertAdjust /home/ubuntu/go/src/github.com/cdongyang/library/rbtree/RBTree.go
    1450ms  3.48% 40.00%     1780ms  4.27%  github.com/cdongyang/library/rbtree_test.BenchmarkSetInsert1E5.func1 /home/ubuntu/go/src/github.com/cdongyang/library/rbtree/bench1e5_test.go
    1400ms  3.36% 43.36%     1400ms  3.36%  runtime.memequal64 /usr/local/go/src/runtime/alg.go
    1150ms  2.76% 46.12%     2650ms  6.35%  runtime.scanobject /usr/local/go/src/runtime/mgcmark.go
    1090ms  2.61% 48.73%     2540ms  6.09%  runtime.mallocgc /usr/local/go/src/runtime/malloc.go
    1060ms  2.54% 51.27%     1060ms  2.54%  runtime.heapBitsForObject /usr/local/go/src/runtime/mbitmap.go
     970ms  2.33% 53.60%     3090ms  7.41%  github.com/cdongyang/library/rbtree.NewCustomSet.func1 /home/ubuntu/go/src/github.com/cdongyang/library/rbtree/set.go
		 920ms  2.21% 55.80%      920ms  2.21%  github.com/cdongyang/library/rbtree.(*SetNode).GetKey /home/ubuntu/go/src/github.com/cdongyang/library/rbtree/set.go
```
#优化一
runtime.ifaceeq为interface的相等比较
将 Iterator == Iterator 这类interface的比较用same函数进行比较,same函数里通过断言为原类型进行比较来加快速度
得到下面的cpu profile

```
File: rbtree.test
Type: cpu
Time: Dec 23, 2017 at 5:43pm (CST)
Duration: 4.61s, Total samples = 4.83s (104.75%)
Entering interactive mode (type "help" for commands, "o" for options)
(pprof) top
Showing nodes accounting for 2910ms, 60.25% of 4830ms total
Dropped 70 nodes (cum <= 24.15ms)
Showing top 10 nodes out of 66
      flat  flat%   sum%        cum   cum%
     800ms 16.56% 16.56%     3320ms 68.74%  github.com/cdongyang/library/rbtree.(*RBTree).insert /home/ubuntu/go/src/github.com/cdongyang/library/rbtree/RBTree.go
     500ms 10.35% 26.92%      910ms 18.84%  github.com/cdongyang/library/rbtree.(*SetNode).Compare <autogenerated>
     360ms  7.45% 34.37%      360ms  7.45%  github.com/cdongyang/library/rbtree.(*IntKey).Compare <autogenerated>
     260ms  5.38% 39.75%      260ms  5.38%  github.com/cdongyang/library/rbtree.NewSet.func3 /home/ubuntu/go/src/github.com/cdongyang/library/rbtree/set.go
     200ms  4.14% 43.89%      930ms 19.25%  github.com/cdongyang/library/rbtree.(*RBTree).insertAdjust /home/ubuntu/go/src/github.com/cdongyang/library/rbtree/RBTree.go
     180ms  3.73% 47.62%      180ms  3.73%  github.com/cdongyang/library/rbtree.(*SetNode).getColor <autogenerated>
     170ms  3.52% 51.14%      350ms  7.25%  github.com/cdongyang/library/rbtree.(*RBTree).Find /home/ubuntu/go/src/github.com/cdongyang/library/rbtree/RBTree.go
     160ms  3.31% 54.45%      370ms  7.66%  github.com/cdongyang/library/rbtree.(*RBTree).eraseAdjust /home/ubuntu/go/src/github.com/cdongyang/library/rbtree/RBTree.go
     160ms  3.31% 57.76%      420ms  8.70%  github.com/cdongyang/library/rbtree.(*RBTree).leftRoate /home/ubuntu/go/src/github.com/cdongyang/library/rbtree/RBTree.go
     120ms  2.48% 60.25%      120ms  2.48%  runtime.heapBitsForObject /usr/local/go/src/runtime/mbitmap.go
```

#优化二:
第二行github.com/cdongyang/library/rbtree.(*SetNode).Compare 
将Iterator.Compare 改为 Iterator.GetKey().Compare
得到下面的cpuprofile

```
File: rbtree.test
Type: cpu
Time: Dec 23, 2017 at 6:01pm (CST)
Duration: 4.61s, Total samples = 4.87s (105.73%)
Entering interactive mode (type "help" for commands, "o" for options)
(pprof) top10
Showing nodes accounting for 2890ms, 59.34% of 4870ms total
Dropped 59 nodes (cum <= 24.35ms)
Showing top 10 nodes out of 71
      flat  flat%   sum%        cum   cum%
     980ms 20.12% 20.12%     3320ms 68.17%  github.com/cdongyang/library/rbtree.(*RBTree).insert /home/ubuntu/go/src/github.com/cdongyang/library/rbtree/RBTree.go
     340ms  6.98% 27.10%     1080ms 22.18%  github.com/cdongyang/library/rbtree.(*RBTree).insertAdjust /home/ubuntu/go/src/github.com/cdongyang/library/rbtree/RBTree.go
     330ms  6.78% 33.88%      330ms  6.78%  github.com/cdongyang/library/rbtree.(*IntKey).Compare <autogenerated>
     260ms  5.34% 39.22%      260ms  5.34%  github.com/cdongyang/library/rbtree.NewSet.func3 /home/ubuntu/go/src/github.com/cdongyang/library/rbtree/set.go
     250ms  5.13% 44.35%      250ms  5.13%  github.com/cdongyang/library/rbtree.(*SetNode).GetKey /home/ubuntu/go/src/github.com/cdongyang/library/rbtree/set.go
     220ms  4.52% 48.87%      380ms  7.80%  runtime.scanobject /usr/local/go/src/runtime/mgcmark.go
     130ms  2.67% 51.54%      360ms  7.39%  github.com/cdongyang/library/rbtree.(*RBTree).Find /home/ubuntu/go/src/github.com/cdongyang/library/rbtree/RBTree.go
     130ms  2.67% 54.21%      350ms  7.19%  github.com/cdongyang/library/rbtree.(*RBTree).leftRoate /home/ubuntu/go/src/github.com/cdongyang/library/rbtree/RBTree.go
     130ms  2.67% 56.88%      130ms  2.67%  github.com/cdongyang/library/rbtree.(*SetNode).rightChild <autogenerated>
     120ms  2.46% 59.34%      300ms  6.16%  runtime.mallocgc /usr/local/go/src/runtime/malloc.go
```
